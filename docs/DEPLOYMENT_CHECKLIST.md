# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Railway

## üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –•–æ—Ä–æ—à–µ–µ
- –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç FastAPI + aiogram (–∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è Railway)
- WebHook –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ª—É—á—à–µ —á–µ–º polling –¥–ª—è production)
- SQLAlchemy –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PostgreSQL)
- Scheduler –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ (APScheduler —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ)
- python-dotenv –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è

1. **Procfile –±—ã–ª –ø—É—Å—Ç–æ–π** ‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î

2. **.env.example –Ω—É–∂–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è Railway
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

3. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Alembic (—Ö–æ—Ä–æ—à–æ!)
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –ø–∞–ø–∫–∞ `alembic/` —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
   - –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ —Å –ø–æ–º–æ—â—å—é `alembic init alembic`

4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç .gitignore** ‚ö†Ô∏è
   - Railway –º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ñ–∞–π–ª .env –µ—Å–ª–∏ –æ–Ω –∫–æ–º–º–∏—á–µ–Ω
   - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª .gitignore (–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–ª–∞)

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ (5 –º–∏–Ω—É—Ç)

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /Users/nezerblah/Documents/TGBot

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Git (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω)
git init

# 3. –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã
git add .

# 4. –ü–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç
git commit -m "Initial commit: Telegram Horoscopes Bot"

# 5. –î–æ–±–∞–≤—å—Ç–µ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git remote add origin https://github.com/YOUR_USERNAME/TGBot.git

# 6. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ GitHub
git push -u origin main
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Railway (3 –º–∏–Ω—É—Ç—ã)

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://railway.app –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ù–∞–∂–º–∏—Ç–µ **"Create New Project"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Deploy from GitHub"**
4. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ Railway –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É GitHub
5. –ù–∞–π–¥–∏—Ç–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `TGBot`
6. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Å–µ—Ä–≤–∏—Å –∏ –Ω–∞—á–Ω–µ—Ç –µ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—Ç—å

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Railway CLI (–¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Railway CLI
npm install -g @railway/cli
# –∏–ª–∏ —á–µ—Ä–µ–∑ Homebrew –Ω–∞ macOS:
# brew install railway

# 2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
railway login

# 3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
railway init

# 4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
# 5. –î–∞–π—Ç–µ –µ–º—É –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: tg-bot)
```

### –≠—Ç–∞–ø 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL (2 –º–∏–Ω—É—Ç—ã)

1. –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Railway –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"+ Add"** –∏–ª–∏ **"Add Service"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"PostgreSQL"** –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - –î–æ–±–∞–≤–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DATABASE_URL` –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ

### –≠—Ç–∞–ø 4: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (3 –º–∏–Ω—É—Ç—ã)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É **"Variables"** –≤ –≤–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–∂–∏–º–∞–π—Ç–µ "+ Add Variable" –¥–ª—è –∫–∞–∂–¥–æ–π):

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å |
|-----------|---------|-------------|
| `BOT_TOKEN` | `123456789:ABCDef...` | @BotFather –≤ Telegram ‚Üí `/newbot` |
| `ADMIN_ID` | `123456789` | @userinfobot –≤ Telegram ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `WEBHOOK_SECRET` | `abc123def456...` | –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–∞–º–∏ (–ª—é–±–∞—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –º–∏–Ω–∏–º—É–º 16 —Å–∏–º–≤–æ–ª–æ–≤) |
| `ENVIRONMENT` | `production` | –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ |
| `WEBHOOK_URL` | –°–º. –Ω–∏–∂–µ ‚¨áÔ∏è | –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |

**‚ö†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç PostgreSQL**

3. –ù–∞–∂–º–∏—Ç–µ "Deploy" –∏–ª–∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 5: –ü–æ–ª—É—á–µ–Ω–∏–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (1 –º–∏–Ω—É—Ç–∞)

1. –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Railway –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É **"Deployments"**
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (—Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "SUCCESS")
3. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"Public URL"** –∏–ª–∏ **"Domain"**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: `https://tg-bot-production-xxxx.up.railway.app`)

### –≠—Ç–∞–ø 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ (2 –º–∏–Ω—É—Ç—ã)

1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –≤–∫–ª–∞–¥–∫—É **"Variables"**
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `WEBHOOK_URL`:
   
   ```
   WEBHOOK_URL=https://–í–ê–®_–°–ö–û–ü–ò–†–û–í–ê–ù–ù–´–ô_URL/webhook/–í–´_–í–´_–£–ö–ê–ó–ê–õ–ò_–í_WEBHOOK_SECRET
   ```
   
   –ù–∞–ø—Ä–∏–º–µ—Ä:
   ```
   WEBHOOK_URL=https://tg-bot-production-abcd1234.up.railway.app/webhook/abc123def456ghi789
   ```

3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### –≠—Ç–∞–ø 7: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–∞ –≤ Telegram (1 –º–∏–Ω—É—Ç–∞)

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ, –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ–±—Ö—É–∫:

#### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—á–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Railway CLI (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
npm install -g @railway/cli

# –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
railway login

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /Users/nezerblah/Documents/TGBot

# –°–≤—è–∂–∏—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º Railroad
railway link

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞
railway run python scripts/set_webhook.py
```

#### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ curl

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≤–∞—à–∏
BOT_TOKEN="123456789:ABCDef..."
WEBHOOK_URL="https://tg-bot-production-xxxx.up.railway.app/webhook/abc123def456..."
WEBHOOK_SECRET="abc123def456..."

curl -X POST "https://api.telegram.org/bot${BOT_TOKEN}/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "'${WEBHOOK_URL}'",
    "secret_token": "'${WEBHOOK_SECRET}'"
  }'
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{"ok":true,"result":true,"description":"Webhook was set"}
```

### –≠—Ç–∞–ø 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (2 –º–∏–Ω—É—Ç—ã)

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   ```bash
   curl https://–í–ê–®_URL/
   ```
   –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–≤–µ—Ç: `{"ok":true}`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ–±—Ö—É–∫–µ:**
   ```bash
   curl "https://api.telegram.org/bot{BOT_TOKEN}/getWebhookInfo"
   ```

3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
   - –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   - –ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å

4. **–°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:**
   - –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Railway –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "Logs"
   - –¢–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ Railway

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Railway CLI (–æ–¥–∏–Ω —Ä–∞–∑)
npm install -g @railway/cli

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)
railway login

# –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É
cd /Users/nezerblah/Documents/TGBot
railway link

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
railway logs

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Railway
railway run python scripts/set_webhook.py

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
railway variables

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–µ–∫—Ç–µ
railway status

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
railway restart

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
railway stop

# –ó–∞–ø—É—Å–∫ –ø–æ–¥–∞–ª—å–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (diagnostics)
railway diagnose
```

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –¥–µ–ø–ª–æ—è —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
  - [ ] –ö–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
  - [ ] requirements.txt —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  - [ ] .env.example —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
  - [ ] Procfile —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

- [ ] **Railway:**
  - [ ] –°–æ–∑–¥–∞–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ railway.com
  - [ ] –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–∑ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- [ ] **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
  - [ ] `BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
  - [ ] `ADMIN_ID` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
  - [ ] `WEBHOOK_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
  - [ ] `ENVIRONMENT` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ "production"
  - [ ] `WEBHOOK_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
  - [ ] `DATABASE_URL` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç PostgreSQL)

- [ ] **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
  - [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ (—Å—Ç–∞—Ç—É—Å "SUCCESS")
  - [ ] –í–µ–±—Ö—É–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Telegram
  - [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  - [ ] –õ–æ–≥–∏ –≤ Railway –≤—ã–≥–ª—è–¥—è—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–Ω–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫)

- [ ] **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  - [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø—ã –≤ 11:00 –ú–°–ö
  - [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)

---

## üÜò –†–µ—à–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### 1. "502 Bad Gateway" –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
railway logs  # –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
```

**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `BOT_TOKEN` –≤–∞–ª–∏–¥–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `$PORT`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `railway restart`

### 2. –í–µ–±—Ö—É–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç / –ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤–µ–±—Ö—É–∫–∞
curl "https://api.telegram.org/bot{BOT_TOKEN}/getWebhookInfo"
```

**–†–µ—à–µ–Ω–∏—è:**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `WEBHOOK_URL` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `WEBHOOK_SECRET` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å –≤–µ–∑–¥–µ
- –ü–æ–≤—Ç–æ—Ä–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–µ–±—Ö—É–∫: `railway run python scripts/set_webhook.py`
- –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `railway logs`

### 3. "Webhook was set but the URL is not reachable"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–æ—Å—å
- URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã Telegram

**–†–µ—à–µ–Ω–∏—è:**
- –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (—Å—Ç–∞—Ç—É—Å "SUCCESS")
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL: `curl https://–≤–∞—à_url/`
- –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤–µ–±—Ö—É–∫–∞ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
railway logs  # –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –æ DATABASE_URL
```

**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `DATABASE_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª–µ–Ω
- –í—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã:
  ```bash
  railway run python -c "from app.db import Base, engine; from app import models; Base.metadata.create_all(bind=engine)"
  ```

### 5. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (scheduler) –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø—ã –≤ 11:00 –ø–æ –ú–°–ö
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å 24/7 (–Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ Railway –º–æ–∂–µ—Ç —Å–ø–∞—Ç—å)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ENVIRONMENT` (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "production")
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `railway logs`

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

| –†–µ—Å—É—Ä—Å | –°—Å—ã–ª–∫–∞ |
|--------|--------|
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Railway | https://docs.railway.app/ |
| Railway CLI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | https://docs.railway.app/reference/cli-api |
| Telegram Bot API | https://core.telegram.org/bots/api |
| aiogram –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | https://docs.aiogram.dev/ |
| FastAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | https://fastapi.tiangolo.com/ |
| SQLAlchemy –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | https://docs.sqlalchemy.org/ |

---

## üí° –°–æ–≤–µ—Ç—ã –¥–ª—è production

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Sentry.io –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
   - –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection pooling –¥–ª—è –ë–î
   - –ö—ç—à–∏—Ä—É–π—Ç–µ –≥–æ—Ä–æ—Å–∫–æ–ø—ã –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è —á–∞—Å—Ç–æ
   - –ò–Ω–¥–µ–∫—Å–∏—Ä—É–π—Ç–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è –≤ –ë–î

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—á—å—Ç–µ .env —Ñ–∞–π–ª—ã
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π `WEBHOOK_SECRET`
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –†–∞–∑–¥–µ–ª–∏—Ç–µ —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Redis (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ Railway)
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

---

**–í—Å–µ –≥–æ—Ç–æ–≤–æ! –ù–∞—á–Ω–∏—Ç–µ —Å –≠—Ç–∞–ø–∞ 1 –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.** üöÄ

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –≤—ã—à–µ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Railway.

