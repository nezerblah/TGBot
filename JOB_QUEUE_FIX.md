# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò JOB_QUEUE

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
AttributeError: 'NoneType' object has no attribute 'run_daily'
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í webhook —Ä–µ–∂–∏–º–µ `app.job_queue` –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ—ç—Ç–æ–º—É –æ–Ω `None`.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–û—à–∏–±–∫–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ–¥–µ:

1. –§—É–Ω–∫—Ü–∏—è `setup_job_queue()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ `None`
2. –°–æ–∑–¥–∞–Ω–∞ –æ–±–µ—Ä—Ç–∫–∞ `post_init_handler()` –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏
3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

---

## üìù –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –≤ main_webhook.py

### –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```python
app.post_init = set_commands

# ... –ø–æ–∑–∂–µ –≤ –∫–æ–¥–µ ...
app.job_queue.run_daily(...)  # ‚ùå job_queue –º–æ–∂–µ—Ç –±—ã—Ç—å None!
```

### –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```python
async def setup_job_queue(app: Application) -> None:
    """–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ."""
    if app.job_queue is None:  # ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ None
        logging.warning("‚ö†Ô∏è Job queue –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
        return
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ job_queue
    app.job_queue.run_daily(daily_horoscope, ...)

async def post_init_handler(app: Application) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""
    await set_commands(app)      # ‚úÖ –ö–æ–º–∞–Ω–¥—ã
    await setup_job_queue(app)   # ‚úÖ –†–∞—Å—Å—ã–ª–∫–∞

app.post_init = post_init_handler
```

---

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### –®–∞–≥ 1: –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
cd ~/PycharmProjects/TGBot
git add TGBot/main_webhook.py
git commit -m "Fix: Proper job_queue initialization in webhook mode"
git push origin main
```

### –®–∞–≥ 2: Railway –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ—Ç–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç –±–æ—Ç–∞.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
railway logs -f
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
INFO - üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ WEBHOOK...
INFO - ‚úÖ Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
INFO - üìÖ –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 16:15 MSK –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
INFO - üì° –ó–∞–ø—É—Å–∫ webhook —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8443...
```

---

## üéä –ì–æ—Ç–æ–≤–æ!

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ webhook —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ production

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –§–∞–π–ª main_webhook.py –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] git add –∏ commit –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] git push –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ GitHub
- [ ] Railway –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª –±–æ—Ç–∞
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞"
- [ ] –ë–æ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤ Telegram (/start —Ä–∞–±–æ—Ç–∞–µ—Ç)

---

**–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! –ë–æ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω! üöÄ**

