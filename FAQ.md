# ‚ùì FAQ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

## üîß –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "ModuleNotFoundError: No module named 'telegram'"

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install -r requirements.txt
```

–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ:
```bash
pip install --upgrade pip
pip install python-telegram-bot==22.6
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "TELEGRAM_BOT_TOKEN not set"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`:
   ```bash
   cp TGBot/.env.example TGBot/.env
   ```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   ```
   TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
   ADMIN_ID=–≤–∞—à_id_–∑–¥–µ—Å—å
   ```

3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª `.env` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `TGBot/`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "database is locked"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –ø–∏—Å–∞—Ç—å –≤ –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –§—É–Ω–∫—Ü–∏—è `_db_operation()` —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è retry-–ª–æ–≥–∏–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø—É—â–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞
- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, —É–¥–∞–ª–∏—Ç–µ `subscriptions.db` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ì–æ—Ä–æ—Å–∫–æ–ø—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è

**–ü—Ä–∏—á–∏–Ω–∞:** –í—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ —Ç–∞–π–º–∑–æ–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞—Å—Å—ã–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ 16:15 MSK –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–∞–π–º–∑–æ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/send_today` (–¥–ª—è –∞–¥–º–∏–Ω–∞) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã

**–ö–æ–¥ —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ main.py:**
```python
msk_tz = pytz.timezone('Europe/Moscow')
job_time = time(hour=16, minute=15, second=0, tzinfo=msk_tz)
app.job_queue.run_daily(daily_horoscope, job_time, days=(0, 1, 2, 3, 4, 5, 6))
```

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è:
```python
# –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è (UTC)
job_time = time(hour=12, minute=30, second=0, tzinfo=msk_tz)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –û—à–∏–±–∫–∞ "403 Forbidden" –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–≤–µ—Ä–Ω—ã–π
- –ë–æ—Ç –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ —á–∞—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ WARNING
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ID –≤–µ—Ä–Ω—ã–π (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ @userinfobot –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —Å–Ω–æ–≤–∞ (/start)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 6: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∞–Ω–æ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ –±–æ–ª—å—à–µ 4000 —Å–∏–º–≤–æ–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –§—É–Ω–∫—Ü–∏—è `_truncate_message()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫
- –≠—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞ 7: –ö–æ–º–∞–Ω–¥–∞ `/send_today` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í .env —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ADMIN_ID
ADMIN_ID=–≤–∞—à_id_–≤_—Ç–µ–ª–µ–≥—Ä–∞–º–µ
```

–£–∑–Ω–∞—Ç—å —Å–≤–æ–π ID:
1. –ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É @userinfobot
2. –û–Ω –æ—Ç–≤–µ—Ç–∏—Ç —Å –≤–∞—à–∏–º ID

---

## üìä –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –í: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≥–æ—Ä–æ—Å–∫–æ–ø–æ–≤?

**–û:** –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Å–º. `parse_horoscope()` –∫–∞–∫ –ø—Ä–∏–º–µ—Ä):

```python
def parse_alternative_horoscope(sign_slug: str) -> tuple[str, dict]:
    """–ü–æ–ª—É—á–∏—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –∏–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞."""
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ _validate_zodiac_slug() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ try-except –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ logging –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    pass
```

–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ `button()` –∏ `daily_horoscope()`.

---

### –í: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î?

**–û:** 
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –ë–î
cp TGBot/subscriptions.db TGBot/subscriptions.db.backup

# –ò–ª–∏ –Ω–∞ –æ–±–ª–∞–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä S3):
aws s3 cp TGBot/subscriptions.db s3://my-bucket/backups/subscriptions.db
```

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ –≤ –∫—Ä–æ–Ω (–¥–ª—è Linux):
```bash
0 3 * * * cp /path/to/subscriptions.db /path/to/backups/subscriptions.db.$(date +\%Y\%m\%d)
```

---

### –í: –ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤?

**–û:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/subscribers` (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)

–ò–ª–∏ —á–µ—Ä–µ–∑ Python:
```python
from main import get_subscribers, zodiac_signs

subs = get_subscribers()
for sign, users in subs.items():
    print(f"{zodiac_signs[sign]}: {len(users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
```

---

### –í: –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î?

**–û:**
```python
from main import unsubscribe_user

user_id = 123456789
unsubscribe_user(user_id)  # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –∏–ª–∏
unsubscribe_user(user_id, 'aries')  # –£–¥–∞–ª–∏—Ç—å –æ–¥–Ω—É –ø–æ–¥–ø–∏—Å–∫—É
```

---

### –í: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏?

**–û:** –î–∞! –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ `main.py`:

```python
job_time = time(hour=16, minute=15, second=0, tzinfo=msk_tz)
#                     ^^        ^^
#                   —á–∞—Å—ã      –º–∏–Ω—É—Ç—ã
```

–í—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–æ –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–º –≤—Ä–µ–º–µ–Ω–∏ (MSK).

---

### –í: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å?

**–û:** 
```python
# –í –Ω–∞—á–∞–ª–µ main.py –∏–∑–º–µ–Ω–∏—Ç–µ
logging.basicConfig(
    level=logging.WARNING,  # –í–º–µ—Å—Ç–æ INFO
    format='%(asctime)s - %(levelname)s - %(message)s'
)
```

–ò–ª–∏ –Ω–∞–ø—Ä–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª:
```python
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log'),
        logging.StreamHandler()
    ]
)
```

---

### –í: –ù—É–∂–Ω–æ –ª–∏ –ø–ª–∞—Ç–∏—Ç—å –∑–∞ Telegram Bot API?

**–û:** –ù–µ—Ç, Telegram Bot API –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π. –í–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Ö–æ—Å—Ç–∏–Ω–≥ –¥–ª—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞.

---

### –í: –ì–¥–µ —Ö–æ—Å—Ç–∏—Ç—å –±–æ—Ç–∞?

**–û:** –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
- **Railway** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –ø—Ä–æ—Å—Ç–æ + free tier)
- **Heroku** (—Ä–∞–Ω—å—à–µ –±—ã–ª –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º, —Ç–µ–ø–µ—Ä—å –ø–ª–∞—Ç–Ω—ã–π)
- **PythonAnywhere** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
- **–û–±–ª–∞–∫–æ** (AWS, Google Cloud, Azure)
- **VPS** (Linode, DigitalOcean, Vultr)
- **–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä** (–µ—Å–ª–∏ –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω)

---

### –í: –ö–∞–∫ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∞–π–ª –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Å–æ–ª–∏?

**–û:**
```python
# –í –Ω–∞—á–∞–ª–µ main.py
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    filename='bot.log',
    filemode='a'  # 'a' –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, 'w' –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
)
```

---

### –í: –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç –Ω–∞ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?

**–û:** 
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ (VPS –∏–ª–∏ –æ–±–ª–∞–∫–æ)
2. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è –∫–µ—à–∞
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î (–¥–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã)
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–î–ª—è –±–æ–ª—å—à–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
# –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –ë–î
conn.execute("CREATE INDEX IF NOT EXISTS idx_user_id ON subscriptions(user_id)")
conn.execute("CREATE INDEX IF NOT EXISTS idx_zodiac ON subscriptions(zodiac_slug)")
```

---

### –í: –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é?

**–û:**
```python
# –î–æ–±–∞–≤—å—Ç–µ –≤ main.py
async def send_to_user_command(update: Update, context: object) -> None:
    user_id = update.effective_user.id
    if user_id != ADMIN_ID:
        await update.message.reply_text("Only admin can use this")
        return
    
    target_user = 123456789  # ID —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    horoscope_text, rates = parse_horoscope('aries')
    msg = _format_horoscope_message('–û–≤–µ–Ω', horoscope_text, rates)
    await _safe_send_message(context, target_user, msg)

# –î–æ–±–∞–≤—å—Ç–µ –≤ main():
app.add_handler(CommandHandler("sendtouser", send_to_user_command))
```

---

## üÜò –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞—à–ª–∏ –æ—Ç–≤–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `tail -f bot.log`
2. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:** [python-telegram-bot docs](https://docs.python-telegram-bot.org/)
3. **–°–æ–∑–¥–∞–π—Ç–µ issue** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å:
   - –ü–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏
   - –õ–æ–≥–∞–º–∏
   - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
   - –í–µ—Ä—Å–∏–µ–π Python

---

**–£–¥–∞—á–∏! üöÄ**

